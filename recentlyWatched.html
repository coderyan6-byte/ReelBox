<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recently Watched - ReelBox+</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: #0b0b0b;
            color: white;
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }

        .nav {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(10,10,10,0.95);
            padding: 16px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

            .nav h1 {
                color: #e50914;
                font-size: 28px;
                font-weight: 700;
            }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill,minmax(160px,1fr));
            gap: 18px;
            padding: 40px;
        }

        .card {
            position: relative;
            cursor: pointer;
            transition: transform .25s, box-shadow .25s;
            border-radius: 10px;
            overflow: hidden;
            background: #111;
            display: flex;
            flex-direction: column;
        }

            .card img {
                width: 100%;
                height: 240px;
                object-fit: cover;
                display: block;
                border-radius: 10px;
            }

            .card span {
                display: block;
                padding: 8px;
                text-align: center;
                font-weight: 600;
                font-size: 14px;
            }

            .card:hover {
                transform: scale(1.05);
                box-shadow: 0 10px 25px rgba(0,0,0,0.7);
            }

        button {
            background: #e50914;
            border: none;
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            margin: 20px;
        }

            button:hover {
                background: #b1060e;
            }
    </style>
</head>
<body>

    <div class="nav">
        <h1>Recently Watched</h1>
    </div>

    <button onclick="goBack()">← Back to Home</button>

    <div class="grid" id="recentGrid"></div>

    <script>
/* ===== AUTH CHECK ===== */
(async ()=>{
    const sb = supabase.createClient(
        "https://vjeqaxbcrhodysiiqxey.supabase.co",
        "sb_publishable_tE3uzAT6BwaEBfQRFfQ2hg_I9KEG8js"
    );
    const res = await sb.auth.getUser();
    if(!res.data.user) location.href="login.html";
})();

/* ===== GET RECENTLY WATCHED FROM LOCAL STORAGE ===== */
function loadRecent() {
    const recent = JSON.parse(localStorage.getItem("recentMovies") || "[]");
    const grid = document.getElementById("recentGrid");
    grid.innerHTML = "";

    if(recent.length === 0){
        grid.innerHTML = "<p style='padding:20px;color:#aaa;'>No recently watched movies yet.</p>";
        return;
    }

    recent.forEach(movie => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<img src="${movie.poster_url || 'Placeholder.png'}"><span>${movie.title}</span>`;
        card.onclick = () => {
            const params = new URLSearchParams();
            params.set('title', movie.title);
            params.set('url', movie.video_url);
            params.set('desc', movie.description || '');
            params.set('category', movie.category || 'Unknown');
            window.location.href = "video.html?" + params.toString();
        };
        grid.appendChild(card);
    });
}

/* ===== BACK BUTTON ===== */
function goBack() {
    window.location.href = "hub.html";
}

loadRecent();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</body>
</html>
